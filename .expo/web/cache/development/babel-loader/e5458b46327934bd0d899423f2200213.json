{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/nikitabeloshapka/webStormProjects/ToDoApp_Firebase/src/context/todo/TodoState.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useReducer, useContext } from 'react';\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { TodoContext } from \"./todoContext\";\nimport { todoReducer } from \"./todoReducer\";\nimport { ADD_TODO, CLEAR_ERROR, FETCH_TODOS, HIDE_LOADER, REMOVE_TODO, SHOW_ERROR, SHOW_LOADER, UPDATE_TODO } from \"../types\";\nimport { ScreenContext } from \"../screen/screenContext\";\nimport { Http } from \"../../http\";\nexport var TodoState = function TodoState(_ref) {\n  var children = _ref.children;\n  var initialState = {\n    todos: [],\n    loading: false,\n    error: null\n  };\n\n  var showLoader = function showLoader() {\n    return dispatch({\n      type: SHOW_LOADER\n    });\n  };\n\n  var hideLoader = function hideLoader() {\n    return dispatch({\n      type: HIDE_LOADER\n    });\n  };\n\n  var showError = function showError(error) {\n    return dispatch({\n      type: SHOW_ERROR,\n      error: error\n    });\n  };\n\n  var clearError = function clearError() {\n    return dispatch({\n      type: CLEAR_ERROR\n    });\n  };\n\n  var updateTodo = function updateTodo(id, title) {\n    return _regeneratorRuntime.async(function updateTodo$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            showLoader();\n            clearError();\n            _context.prev = 2;\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(fetch(\"https://todoapp-aa2ea-default-rtdb.europe-west1.firebasedatabase.app/todos/\" + id + \".json\", {\n              method: 'PATCH',\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify({\n                title: title\n              })\n            }));\n\n          case 5:\n            dispatch({\n              type: UPDATE_TODO,\n              id: id,\n              title: title\n            });\n            _context.next = 12;\n            break;\n\n          case 8:\n            _context.prev = 8;\n            _context.t0 = _context[\"catch\"](2);\n            showError('Что-то пошло не так...');\n            console.log(_context.t0);\n\n          case 12:\n            _context.prev = 12;\n            hideLoader();\n            return _context.finish(12);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[2, 8, 12, 15]], Promise);\n  };\n\n  var fetchTodos = function fetchTodos() {\n    var response, data, todos;\n    return _regeneratorRuntime.async(function fetchTodos$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            showLoader();\n            clearError();\n            _context2.prev = 2;\n            _context2.next = 5;\n            return _regeneratorRuntime.awrap(fetch('https://todoapp-aa2ea-default-rtdb.europe-west1.firebasedatabase.app/todos.json', {\n              method: 'GET',\n              headers: {\n                'Content-Type': 'application/json'\n              }\n            }));\n\n          case 5:\n            response = _context2.sent;\n            _context2.next = 8;\n            return _regeneratorRuntime.awrap(response.json());\n\n          case 8:\n            data = _context2.sent;\n            todos = Object.keys(data).map(function (key) {\n              return _objectSpread(_objectSpread({}, data[key]), {}, {\n                id: key\n              });\n            });\n            dispatch({\n              type: FETCH_TODOS,\n              todos: todos\n            });\n            _context2.next = 17;\n            break;\n\n          case 13:\n            _context2.prev = 13;\n            _context2.t0 = _context2[\"catch\"](2);\n            showError('Что-то пошло не так...');\n            console.log(_context2.t0);\n\n          case 17:\n            _context2.prev = 17;\n            hideLoader();\n            return _context2.finish(17);\n\n          case 20:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[2, 13, 17, 20]], Promise);\n  };\n\n  var _useContext = useContext(ScreenContext),\n      changeScreen = _useContext.changeScreen;\n\n  var _useReducer = useReducer(todoReducer, initialState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var addTodo = function addTodo(title) {\n    var data;\n    return _regeneratorRuntime.async(function addTodo$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            clearError();\n            _context3.prev = 1;\n            _context3.next = 4;\n            return _regeneratorRuntime.awrap(Http.post('https://todoapp-aa2ea-default-rtdb.europe-west1.firebasedatabase.app/todos.json', {\n              title: title\n            }));\n\n          case 4:\n            data = _context3.sent;\n            dispatch({\n              type: ADD_TODO,\n              title: title,\n              id: data.name\n            });\n            _context3.next = 11;\n            break;\n\n          case 8:\n            _context3.prev = 8;\n            _context3.t0 = _context3[\"catch\"](1);\n            showError(\"Что-то пошло не так...\");\n\n          case 11:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[1, 8]], Promise);\n  };\n\n  var removeTodo = function removeTodo(id) {\n    var todo = state.todos.find(function (t) {\n      return t.id === id;\n    });\n    Alert.alert('Удаление элемента', \"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B, \\u0447\\u0442\\u043E \\u0445\\u043E\\u0442\\u0438\\u0442\\u0435 \\u0443\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\\"\" + todo.title + \"\\\"?\", [{\n      text: 'Отмена',\n      style: 'cancel'\n    }, {\n      text: 'Удалить',\n      style: 'destructive',\n      onPress: function onPress() {\n        return _regeneratorRuntime.async(function onPress$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                changeScreen(null);\n                _context4.next = 3;\n                return _regeneratorRuntime.awrap(fetch(\"https://todoapp-aa2ea-default-rtdb.europe-west1.firebasedatabase.app/todos/\" + id + \".json\", {\n                  method: 'DELETE',\n                  headers: {\n                    'Content-Type': 'application/json'\n                  }\n                }));\n\n              case 3:\n                dispatch({\n                  type: REMOVE_TODO,\n                  id: id\n                });\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      }\n    }], {\n      cancelable: false\n    });\n  };\n\n  return React.createElement(TodoContext.Provider, {\n    value: {\n      todos: state.todos,\n      loading: state.loading,\n      error: state.error,\n      addTodo: addTodo,\n      removeTodo: removeTodo,\n      updateTodo: updateTodo,\n      fetchTodos: fetchTodos\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 5\n    }\n  }, children);\n};","map":{"version":3,"sources":["/Users/nikitabeloshapka/webStormProjects/ToDoApp_Firebase/src/context/todo/TodoState.js"],"names":["React","useReducer","useContext","TodoContext","todoReducer","ADD_TODO","CLEAR_ERROR","FETCH_TODOS","HIDE_LOADER","REMOVE_TODO","SHOW_ERROR","SHOW_LOADER","UPDATE_TODO","ScreenContext","Http","TodoState","children","initialState","todos","loading","error","showLoader","dispatch","type","hideLoader","showError","clearError","updateTodo","id","title","fetch","method","headers","body","JSON","stringify","console","log","fetchTodos","response","json","data","Object","keys","map","key","changeScreen","state","addTodo","post","name","removeTodo","todo","find","t","Alert","alert","text","style","onPress","cancelable"],"mappings":"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","sourcesContent":["import React, { useReducer, useContext } from 'react'\nimport { Alert } from 'react-native'\nimport { TodoContext } from './todoContext'\nimport { todoReducer } from './todoReducer'\nimport {\n    ADD_TODO,\n    CLEAR_ERROR,\n    FETCH_TODOS,\n    HIDE_LOADER,\n    REMOVE_TODO,\n    SHOW_ERROR,\n    SHOW_LOADER,\n    UPDATE_TODO\n} from '../types'\nimport {ScreenContext} from \"../screen/screenContext\";\nimport {Http} from \"../../http\";\n\n\nexport const TodoState = ({ children }) => {\n  const initialState = {\n    todos: [],\n    loading: false,\n    error: null,\n  }\n\n  const showLoader = () => dispatch({type: SHOW_LOADER})\n  const hideLoader = () => dispatch({type: HIDE_LOADER})\n  const showError = (error) => dispatch({type: SHOW_ERROR, error})\n  const clearError = () => dispatch({type: CLEAR_ERROR})\n  const updateTodo = async (id, title) => {\n      showLoader()\n      clearError()\n      try {\n          await fetch(`https://todoapp-aa2ea-default-rtdb.europe-west1.firebasedatabase.app/todos/${id}.json`,{\n              method: 'PATCH',\n              headers: {'Content-Type': 'application/json'},\n              body: JSON.stringify({title})\n          } )\n          dispatch({type: UPDATE_TODO, id, title})\n      } catch (e) {\n          showError('Что-то пошло не так...')\n          console.log(e)\n      } finally {\n          hideLoader()\n      }\n  }\n\n\n  const fetchTodos = async () => {\n      showLoader()\n      clearError()\n      try {\n          const response = await fetch('https://todoapp-aa2ea-default-rtdb.europe-west1.firebasedatabase.app/todos.json', {\n              method: 'GET',\n              headers: {'Content-Type': 'application/json'},\n          })\n          const data = await response.json()\n          const todos = Object.keys(data).map((key) => {\n              return {...data[key], id: key}\n          })\n          dispatch({type: FETCH_TODOS, todos})\n      } catch (e) {\n          showError('Что-то пошло не так...')\n          console.log(e)\n      } finally {\n          hideLoader()\n\n      }\n  }\n\n\n  const {changeScreen} = useContext(ScreenContext)\n\n  const [state, dispatch] = useReducer(todoReducer, initialState)\n\n  const addTodo = async title => {\n      // const response = await fetch('https://todoapp-aa2ea-default-rtdb.europe-west1.firebasedatabase.app/todos.json', {\n      //     method: 'POST',\n      //     headers: {'Content-Type': 'application/json'},\n      //     body: JSON.stringify({title})\n      // })\n      clearError()\n      try {\n          const data = await Http.post('https://todoapp-aa2ea-default-rtdb.europe-west1.firebasedatabase.app/todos.json', {title})\n          dispatch({ type: ADD_TODO, title, id: data.name })\n      } catch (e) {\n          showError(\"Что-то пошло не так...\")\n      }\n\n  }\n\n  const removeTodo = id => {\n      const todo = state.todos.find(t => t.id === id)\n      Alert.alert(\n              'Удаление элемента',\n              `Вы уверены, что хотите удалить \"${todo.title}\"?`,\n              [\n                {\n                  text: 'Отмена',\n                  style: 'cancel'\n                },\n                {\n                  text: 'Удалить',\n                  style: 'destructive',\n                  onPress: async () => {\n                      changeScreen(null)\n                      await fetch(`https://todoapp-aa2ea-default-rtdb.europe-west1.firebasedatabase.app/todos/${id}.json`, {\n                          method: 'DELETE',\n                          headers: {'Content-Type': 'application/json'},\n\n                      })\n                      dispatch({ type: REMOVE_TODO, id })\n                  }\n                }\n              ],\n              { cancelable: false }\n            )\n  }\n\n\n  return (\n    <TodoContext.Provider\n      value={{\n          todos: state.todos,\n          loading: state.loading,\n          error: state.error,\n          addTodo,\n          removeTodo,\n          updateTodo,\n          fetchTodos,\n\n      }}\n    >\n      {children}\n    </TodoContext.Provider>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}